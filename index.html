<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Extrator de Neg√≥cios Flowmize</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: Arial; margin: 20px; background: #f4f4f4; }
    input, button { padding: 10px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    #map { height: 400px; margin-top: 10px; border-radius: 10px; }
  </style>
</head>
<body>
  <h2>üåç Extrator de Neg√≥cios Gr√°tis (OpenStreetMap)</h2>
  <input id="query" type="text" placeholder="Ex: pizzaria S√£o Lu√≠s" size="40">
  <button onclick="buscar()">Buscar</button>

  <div id="map"></div>

  <table id="resultados">
    <thead><tr><th>Nome</th><th>Endere√ßo</th><th>Telefone</th></tr></thead>
    <tbody></tbody>
  </table>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let map = L.map('map').setView([-5.1, -42.8], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    async function buscar() {
      const termo = document.getElementById("query").value;
      if (!termo) return alert("Digite algo para pesquisar!");

      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(termo)}`;
      const resp = await fetch(url);
      const data = await resp.json();
      if (!data.length) return alert("Nenhum resultado encontrado.");

      const { lat, lon } = data[0];
      map.setView([lat, lon], 14);

      const overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];node(around:5000,${lat},${lon})[name];out;`;
      const overpassResp = await fetch(overpassUrl);
      const overpassData = await overpassResp.json();

      const tbody = document.querySelector("#resultados tbody");
      tbody.innerHTML = "";
      overpassData.elements.forEach(el => {
        const nome = el.tags.name || "Sem nome";
        const endereco = el.tags["addr:full"] || el.tags["addr:street"] || "N√£o informado";
        const telefone = el.tags.phone || el.tags["contact:phone"] || "N√£o informado";

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${nome}</td><td>${endereco}</td><td>${telefone}</td>`;
        tbody.appendChild(tr);

        if (el.lat && el.lon) {
          L.marker([el.lat, el.lon])
            .addTo(map)
            .bindPopup(`<b>${nome}</b><br>${endereco}<br>${telefone}`);
        }
      });
    }
  </script>
</body>
</html>
